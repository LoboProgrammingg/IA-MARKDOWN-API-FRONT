<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatBOT - MTI IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
        .prose-sm {
            font-size: 0.875rem;
            line-height: 1.5;
        }
        .prose-sm h1, .prose-sm h2, .prose-sm h3 {
            margin-top: 1.25em;
            margin-bottom: 0.75em;
            font-weight: 600;
        }
        .prose-sm p {
            margin-top: 0.75em;
            margin-bottom: 0.75em;
        }
        .prose-sm ul, .prose-sm ol {
            padding-left: 1.5em;
            margin-top: 0.75em;
            margin-bottom: 0.75em;
        }
        .prose-sm li {
            margin-bottom: 0.5em;
        }
        .prose-sm code {
            background-color: rgba(97, 97, 97, 0.1);
            padding: 0.2em 0.4em;
            border-radius: 0.25em;
            font-family: monospace;
        }
        .prose-sm pre {
            background-color: rgba(97, 97, 97, 0.1);
            padding: 1em;
            border-radius: 0.5em;
            overflow-x: auto;
            margin-top: 1em;
            margin-bottom: 1em;
        }
        .prose-sm blockquote {
            border-left: 4px solid #e5e7eb;
            padding-left: 1em;
            margin-left: 0;
            margin-right: 0;
            font-style: italic;
            color: #6b7280;
        }
        .dark .prose-sm code {
            background-color: rgba(156, 163, 175, 0.2);
        }
        .dark .prose-sm pre {
            background-color: rgba(156, 163, 175, 0.2);
        }
        .dark .prose-sm blockquote {
            border-left-color: #4b5563;
            color: #9ca3af;
        }
        .typing-indicator {
            display: inline-flex;
            align-items: center;
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #3b82f6;
            margin-right: 4px;
            animation: typing-dot 1.5s infinite ease-in-out;
        }
        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }
        .typing-dot:nth-child(2) {
            animation-delay: 0.3s;
        }
        .typing-dot:nth-child(3) {
            animation-delay: 0.6s;
            margin-right: 0;
        }
        @keyframes typing-dot {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 1;
            }
            30% {
                transform: translateY(-5px);
                opacity: 0.5;
            }
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-200">
    <div x-data="{ showConfirm: false, isMobileMenuOpen: false }" class="h-screen flex flex-col">
        <!-- Mobile menu button -->
        <div class="md:hidden bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 flex items-center justify-between px-4 py-3">
            <h1 class="text-xl font-semibold">Assistente IA</h1>
            <button @click="isMobileMenuOpen = !isMobileMenuOpen" class="p-2 rounded-md text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                <i class="bi bi-list text-2xl"></i>
            </button>
        </div>

        <!-- Mobile menu -->
        <div x-show="isMobileMenuOpen" @click.away="isMobileMenuOpen = false" 
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95"
             class="md:hidden bg-white dark:bg-gray-800 shadow-lg rounded-b-lg z-50 absolute w-full">
            <nav class="px-4 py-3 space-y-2">
                <a href="#" class="flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg">
                    <i class="bi bi-chat-right-text-fill mr-3 text-lg"></i> ChatBOT
                </a>
                <a href="#" class="flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                    <i class="bi bi-file-earmark-zip-fill mr-3 text-lg"></i> Documentos
                </a>
                <a href="#" class="flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                    <i class="bi bi-bar-chart-line-fill mr-3 text-lg"></i> Dashboards
                </a>
                <a href="#" class="flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                    <i class="bi bi-house-door-fill mr-3 text-lg"></i> Tela Inicial
                </a>
                <button @click="showConfirm = true" class="w-full flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                    <i class="bi bi-plus-square mr-3 text-lg"></i> Nova Conversa
                </button>
            </nav>
        </div>

        <div class="flex flex-1 overflow-hidden">
            <!-- Desktop sidebar -->
            <aside class="hidden md:flex w-64 flex-shrink-0 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex-col">
                <div class="h-16 flex items-center justify-center border-b border-gray-200 dark:border-gray-700">
                    <h2 class="text-lg font-semibold text-gray-700 dark:text-gray-200">Navegação</h2>
                </div>
                <nav class="flex-1 flex flex-col px-4 py-4 space-y-2">
                    <a href="#" class="flex items-center px-4 py-2.5 text-sm font-medium text-white bg-blue-600 rounded-lg">
                        <i class="bi bi-chat-right-text-fill mr-3 text-lg"></i> ChatBOT
                    </a>
                    <a href="#" class="flex items-center px-4 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                        <i class="bi bi-file-earmark-zip-fill mr-3 text-lg"></i> Documentos
                    </a>
                    <a href="#" class="flex items-center px-4 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                        <i class="bi bi-bar-chart-line-fill mr-3 text-lg"></i> Dashboards
                    </a>
                </nav>
                <div class="mt-auto px-4 py-4 space-y-2 border-t border-gray-200 dark:border-gray-700">
                    <a href="#" class="flex items-center px-4 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                        <i class="bi bi-house-door-fill mr-3 text-lg"></i> Tela Inicial
                    </a>
                    <button @click="showConfirm = true" class="w-full flex items-center px-4 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                        <i class="bi bi-plus-square mr-3 text-lg"></i> Nova Conversa
                    </button>
                </div>
                <div class="p-4 border-t border-gray-200 dark:border-gray-700">
                    <p class="text-xs text-gray-400">© 2023 MTI IA</p>
                </div>
            </aside>

            <!-- Main content -->
            <div class="flex-1 flex flex-col overflow-hidden bg-gray-50 dark:bg-gray-900">
                <!-- Header -->
                <div class="bg-white/80 dark:bg-gray-800/50 backdrop-blur-sm shadow-sm border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex justify-between items-center">
                    <h1 class="text-xl font-semibold">Assistente IA</h1>
                    <div class="flex items-center space-x-4">
                        <button @click="showConfirm = true" type="button" class="hidden md:flex items-center text-gray-500 hover:text-blue-600 dark:hover:text-blue-400 transition-colors px-3 py-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="bi bi-plus-square mr-2"></i>
                            <span class="text-sm">Nova Conversa</span>
                        </button>
                        <button class="md:hidden text-gray-500 hover:text-blue-600 dark:hover:text-blue-400">
                            <i class="bi bi-plus-square text-xl"></i>
                        </button>
                    </div>
                </div>

                <!-- Chat window -->
                <div id="chat-window" class="flex-1 overflow-y-auto p-4 space-y-6 scroll-smooth scrollbar-hide">
                    <!-- Welcome screen -->
                    <div class="flex flex-col items-center justify-center h-full text-center py-12">
                        <div class="text-5xl font-black bg-gradient-to-r from-blue-600 to-blue-400 dark:from-blue-400 dark:to-cyan-300 bg-clip-text text-transparent mb-6">
                            MTI IA
                        </div>
                        <p class="text-lg font-medium text-gray-600 dark:text-gray-300 mb-8">Como posso te ajudar hoje?</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-lg w-full">
                            <button class="prompt-suggestion text-left p-4 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-all border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md">
                                <p class="text-sm font-semibold text-gray-800 dark:text-gray-100">Fazer um resumo</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">sobre o Regimento Interno da UGGOV</p>
                            </button>
                            <button class="prompt-suggestion text-left p-4 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-all border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md">
                                <p class="text-sm font-semibold text-gray-800 dark:text-gray-100">Listar os riscos</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">associados à unidade UGGOV</p>
                            </button>
                            <button class="prompt-suggestion text-left p-4 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-all border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md">
                                <p class="text-sm font-semibold text-gray-800 dark:text-gray-100">Explicar o processo</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">de gestão de documentos</p>
                            </button>
                            <button class="prompt-suggestion text-left p-4 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-all border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md">
                                <p class="text-sm font-semibold text-gray-800 dark:text-gray-100">Mostrar exemplos</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">de formulários utilizados</p>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Input area -->
                <div class="bg-white/80 dark:bg-gray-800/50 backdrop-blur-sm p-4 border-t border-gray-200 dark:border-gray-700">
                    <form id="chat-form" class="flex items-center space-x-3 max-w-4xl mx-auto">
                        <div class="relative flex-1">
                            <input type="text" id="chat-input" placeholder="Digite sua mensagem para o assistente..." autocomplete="off" 
                                   class="w-full px-5 py-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow pr-12">
                            <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-blue-500">
                                <i class="bi bi-mic-fill text-xl"></i>
                            </button>
                        </div>
                        <button type="submit" class="bg-blue-600 text-white rounded-full w-12 h-12 flex-shrink-0 flex items-center justify-center shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 focus:ring-blue-500 transform hover:scale-105 transition">
                            <span class="sr-only">Enviar</span>
                            <i class="bi bi-send-fill text-xl"></i>
                        </button>
                    </form>
                    <p class="text-xs text-center text-gray-500 dark:text-gray-400 mt-2">
                        MTI IA pode cometer erros. Verifique informações importantes.
                    </p>
                </div>
            </div>
        </div>

        <!-- New chat confirmation modal -->
        <div x-show="showConfirm" 
             x-transition:enter="ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div @click.away="showConfirm = false" class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-sm w-full p-6 text-center">
                <div class="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-blue-100 dark:bg-blue-900/30">
                    <i class="bi bi-sparkles text-2xl text-blue-600 dark:text-blue-400"></i>
                </div>
                <h3 class="mt-4 text-lg font-semibold text-gray-900 dark:text-white">Iniciar Nova Conversa</h3>
                <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                    Isso irá limpar a tela para um novo diálogo. Seu histórico anterior será mantido.
                </p>
                <div class="mt-6 flex justify-center space-x-4">
                    <button @click="showConfirm = false" type="button" class="px-6 py-2 text-sm font-medium rounded-md bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                        Cancelar
                    </button>
                    <a href="#" class="inline-block px-6 py-2 text-sm font-medium rounded-md bg-blue-600 text-white hover:bg-blue-700 transition-colors">
                        Sim, Iniciar
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.12.0/dist/cdn.min.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            function parseMarkdown(text) {
                if (window.marked) {
                    return marked.parse(text, { breaks: true, gfm: true });
                }
                return text.replace(/\n/g, '<br>');
            }

            const chatWindow = document.getElementById('chat-window');
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-input');
            
            // Mock session ID for demo purposes
            const sessionId = 'session_' + Math.random().toString(36).substr(2, 9);
            
            function smoothScrollToBottom() {
                chatWindow.scrollTo({
                    top: chatWindow.scrollHeight,
                    behavior: 'smooth'
                });
            }

            function addMessage(message, sender, messageId = null) {
                const uniqueId = sender + '-' + (messageId || Date.now());
                let messageHtml = '';

                if (sender === 'user') {
                    messageHtml = `
                        <div id="${uniqueId}" class="flex items-start gap-3 justify-end animate-fade-in">
                            <div class="bg-blue-600 p-4 rounded-xl rounded-br-none shadow-lg max-w-[85%]">
                                <p class="text-sm text-white">${message}</p>
                            </div>
                            <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold flex-shrink-0 shadow-md">
                                <i class="bi bi-person-fill"></i>
                            </div>
                        </div>`;
                } else {
                    const escapedMessage = message.replace(/"/g, '&quot;');
                    const htmlContent = parseMarkdown(message);
                    
                    messageHtml = `
                        <div id="${uniqueId}" class="flex items-start gap-3 justify-start animate-fade-in">
                            <div class="w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold flex-shrink-0 shadow-md">
                                IA
                            </div>
                            <div class="bg-white dark:bg-gray-700 p-4 rounded-xl rounded-tl-none shadow-lg max-w-[85%] w-full">
                                <div class="prose prose-sm dark:prose-invert max-w-none">${htmlContent}</div>
                                <div class="mt-4 pt-2 border-t border-gray-200 dark:border-gray-600 flex items-center justify-end gap-2">
                                    <span class="text-xs text-gray-400">Esta resposta foi útil?</span>
                                    <button class="feedback-btn p-1.5 text-gray-500 hover:text-green-500 rounded-full hover:bg-gray-100 dark:hover:bg-gray-600" data-feedback="1" title="Gostei">
                                        <i class="bi bi-hand-thumbs-up"></i>
                                    </button>
                                    <button class="feedback-btn p-1.5 text-gray-500 hover:text-red-500 rounded-full hover:bg-gray-100 dark:hover:bg-gray-600" data-feedback="-1" title="Não Gostei">
                                        <i class="bi bi-hand-thumbs-down"></i>
                                    </button>
                                    <button class="copy-button p-1.5 text-gray-500 hover:text-blue-500 rounded-full hover:bg-gray-100 dark:hover:bg-gray-600" title="Copiar resposta" data-copy-text="${escapedMessage}">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                            </div>
                        </div>`;
                }
                
                chatWindow.insertAdjacentHTML('beforeend', messageHtml);
                smoothScrollToBottom();
            }

            function showTypingIndicator() {
                const typingHtml = `
                    <div id="typing-indicator" class="flex items-start gap-3 justify-start animate-fade-in">
                        <div class="w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold flex-shrink-0 shadow-md">
                            IA
                        </div>
                        <div class="bg-white dark:bg-gray-700 p-4 rounded-xl rounded-tl-none shadow-lg">
                            <div class="typing-indicator">
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                            </div>
                        </div>
                    </div>`;
                
                chatWindow.insertAdjacentHTML('beforeend', typingHtml);
                smoothScrollToBottom();
            }

            function removeTypingIndicator() {
                const indicator = document.getElementById('typing-indicator');
                if (indicator) indicator.remove();
            }

            // Handle form submission
            chatForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const userMessage = chatInput.value.trim();
                if (!userMessage) return;
                
                // Remove welcome screen if present
                const welcomeScreen = document.querySelector('.flex.flex-col.items-center.justify-center.h-full');
                if (welcomeScreen) welcomeScreen.remove();
                
                // Add user message
                addMessage(userMessage, 'user');
                chatInput.value = '';
                
                // Show typing indicator
                showTypingIndicator();
                
                // Simulate API response after delay
                setTimeout(() => {
                    removeTypingIndicator();
                    
                    // Mock response - in a real app, this would come from your API
                    const responses = [
                        "Entendi sua pergunta sobre o Regimento Interno da UGGOV. O documento estabelece as normas e procedimentos para a gestão da unidade, incluindo competências, estrutura organizacional e fluxos de trabalho.",
                        "Os principais riscos associados à UGGOV incluem: \n\n1. Riscos operacionais relacionados a processos internos\n2. Riscos de conformidade com legislação aplicável\n3. Riscos de segurança da informação\n4. Riscos reputacionais\n\nCada um desses riscos possui planos de ação específicos para mitigação.",
                        "O processo de gestão de documentos na UGGOV segue as diretrizes da política de arquivos da instituição, com etapas claras de classificação, indexação, armazenamento e descarte, garantindo a preservação e o fácil acesso às informações.",
                        "Os formulários utilizados na UGGOV incluem:\n\n- Formulário de Requisição de Serviços\n- Formulário de Registro de Ocorrências\n- Formulário de Solicitação de Compras\n- Formulário de Avaliação de Desempenho\n\nTodos estão disponíveis no sistema de gestão documental."
                    ];
                    
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    addMessage(randomResponse, 'bot', 'msg_' + Date.now());
                }, 1500 + Math.random() * 2000);
            });

            // Handle prompt suggestions
            document.querySelectorAll('.prompt-suggestion').forEach(button => {
                button.addEventListener('click', function() {
                    const title = this.querySelector('p:first-child').textContent;
                    const subtitle = this.querySelector('p:last-child').textContent;
                    const fullPrompt = `${title} ${subtitle}`;
                    
                    chatInput.value = fullPrompt;
                    chatForm.dispatchEvent(new Event('submit', { cancelable: true }));
                });
            });

            // Handle feedback and copy buttons
            chatWindow.addEventListener('click', function(e) {
                // Feedback buttons
                if (e.target.closest('.feedback-btn')) {
                    const button = e.target.closest('.feedback-btn');
                    const actionBar = button.parentElement;
                    
                    if (button.dataset.feedback === '1') {
                        actionBar.innerHTML = '<span class="text-xs text-green-600 dark:text-green-400 font-medium">Obrigado pelo seu feedback!</span>';
                    } else {
                        actionBar.innerHTML = '<span class="text-xs text-red-600 dark:text-red-400 font-medium">Obrigado, vamos melhorar.</span>';
                    }
                }
                
                // Copy buttons
                if (e.target.closest('.copy-button')) {
                    const button = e.target.closest('.copy-button');
                    const textToCopy = button.dataset.copyText;
                    
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        const originalIcon = button.innerHTML;
                        button.innerHTML = '<i class="bi bi-check-lg text-green-500"></i>';
                        
                        setTimeout(() => {
                            button.innerHTML = originalIcon;
                        }, 2000);
                    });
                }
            });
        });
    </script>
</body>
</html>