{% load static %}
<!doctype html>
<!-- 
  ===============================================================
  1. Otimização do HTML
  ===============================================================
  - lang="pt-BR" é mais específico para o idioma.
  - O x-data do Alpine.js agora controla tanto o tema escuro quanto o menu mobile,
    centralizando o estado da página em um só lugar.
-->
<html lang="pt-BR" 
      x-data="{ 
          darkMode: localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches),
          mobileMenuOpen: false 
      }" 
      x-init="$watch('darkMode', val => localStorage.setItem('theme', val ? 'dark' : 'light'))"
      x-bind:class="{ 'dark': darkMode }"
      class="h-full scroll-smooth">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}UGGOV IA{% endblock %}</title>

    <!-- 
      ===============================================================
      2. Fontes e Scripts Profissionais
      ===============================================================
      - Adicionamos a fonte "Inter" do Google Fonts, padrão em UIs modernas.
      - Todos os scripts JS agora usam 'defer' para otimizar o carregamento da página.
    -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com?plugins=typography,forms"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{% static 'core/css/chat.css' %}">
    {% block extra_css %}{% endblock %}

    <!-- Configuração do Tailwind para usar a nova fonte e cores -->
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            colors: {
              uggovBlue: {
                DEFAULT: '#0A3A67',
                '50': '#E6F0F8', '100': '#CFE1F1', '200': '#B8D2EA', '300': '#A1C3E3', '400': '#8AB4DD', '500': '#73A5D6', '600': '#5C96CF', '700': '#4587C8', '800': '#2E78C1', '900': '#1769BA', '950': '#0A3A67'
              },
              uggovGold: '#D4AF37',
            }
          }
        }
      }
    </script>
</head>
<!-- 
  ===============================================================
  3. Corpo com Fundo Sutil
  ===============================================================
  - Um gradiente radial muito sutil dá profundidade à página,
    evitando a aparência "chapada" de uma cor sólida.
-->
<body class="h-full bg-slate-200 dark:bg-gray-900 text-slate-800 dark:text-slate-200 antialiased transition-colors duration-500 font-sans">

    {% if user.is_authenticated %}
    <!-- 
      HEADER COM EFEITO "GLASSMORPHISM" APRIMORADO
      - O header reage ao scroll da página, ficando mais visível.
      - A inicialização `x-data` aqui controla o estado do scroll.
    -->
    <header x-data="{ atTop: true }" @scroll.window="atTop = (window.pageYOffset < 50)"
            :class="{ 'border-transparent': atTop, 'bg-slate-50/80 dark:bg-slate-900/80 backdrop-blur-lg border-slate-200/50 dark:border-slate-700/50': !atTop }"
            class="sticky top-0 z-50 transition-all duration-300 border-b">
        <div class="w-full max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                
                <div class="flex items-center space-x-4">
                    <a href="{% url 'home' %}" class="flex items-center space-x-2 group">
                        <span class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-uggovBlue-800 to-uggovBlue-500 dark:from-sky-400 dark:to-cyan-300">
                            MTI IA
                        </span>
                    </a>
                </div>

                <div class="hidden md:flex items-center space-x-4">
                    <!-- 
                      BOTÃO DE TOGGLE PARA MODO ESCURO/CLARO
                      - @click="darkMode = !darkMode": Inverte o estado da variável 'darkMode'.
                      - O ícone muda de 'bi-moon-stars-fill' para 'bi-sun-fill' com base no estado.
                    -->
                    <button @click="darkMode = !darkMode" type="button" class="flex items-center justify-center h-9 w-9 rounded-full text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-800 transition-colors">
                        <span class="sr-only">Alternar tema</span>
                        <i x-show="!darkMode" class="bi bi-moon-stars-fill text-lg"></i>
                        <i x-show="darkMode" class="bi bi-sun-fill text-lg text-amber-400" style="display: none;"></i>
                    </button>

                    <!-- Dropdown do Usuário Aprimorado -->
                    <div x-data="{ open: false }" class="relative">
                        <button @click="open = !open" class="flex items-center space-x-2 rounded-full p-1 hover:bg-slate-200 dark:hover:bg-slate-800 transition-colors duration-200 focus:outline-none">
                            {% if user.profile.image and user.profile.image.name != 'profile_pics/default.jpg' %}
                                <img class="h-8 w-8 rounded-full object-cover ring-2 ring-slate-300 dark:ring-slate-600" src="{{ user.profile.image.url }}" alt="Foto de Perfil">
                            {% else %}
                                <div class="h-8 w-8 rounded-full bg-slate-500 flex items-center justify-center ring-2 ring-slate-400 dark:ring-slate-600">
                                    <svg class="h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                        <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0Zm-2.25 9.75a7.5 7.5 0 0 1 13.5 0v.75c0 .414.336.75.75.75h.75a.75.75 0 0 0 .75-.75v-.75a9 9 0 0 0-18 0v.75c0 .414.336.75.75.75h.75a.75.75 0 0 0 .75-.75v-.75Z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            {% endif %}
                        </button>
                        
                        <div x-show="open" 
                             @click.away="open = false" 
                             x-transition
                             class="absolute right-0 mt-2 w-56 origin-top-right bg-white dark:bg-slate-800 rounded-md shadow-lg py-1 z-50 ring-1 ring-black ring-opacity-5"
                             style="display: none;">
                            <div class="px-4 py-3 border-b border-slate-200 dark:border-slate-700">
                                <p class="text-sm text-slate-700 dark:text-slate-300">Logado como</p>
                                <p class="text-sm font-medium text-slate-900 dark:text-white truncate">{{ user.first_name|default:user.username }}</p>
                            </div>
                            <div class="py-1">
                                <a href="{% url 'profile' %}" class="flex items-center px-4 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"><i class="bi bi-person-circle mr-3"></i> Meu Perfil</a>
                            </div>
                            <div class="py-1 border-t border-slate-200 dark:border-slate-700">
                                <form method="post" action="{% url 'logout' %}">
                                    {% csrf_token %}
                                    <button type="submit" class="w-full text-left flex items-center px-4 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"><i class="bi bi-box-arrow-right mr-3"></i> Sair</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botão do Menu Mobile (agora funcional) -->
                <div class="md:hidden flex items-center">
                    <button @click="mobileMenuOpen = !mobileMenuOpen" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-800">
                        <i x-show="!mobileMenuOpen" class="bi bi-list text-2xl"></i>
                        <i x-show="mobileMenuOpen" class="bi bi-x-lg text-2xl" style="display: none;"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- 
          PAINEL DO MENU MOBILE
          - Fica sobre todo o conteúdo (z-40) e só aparece quando 'mobileMenuOpen' é true.
          - Tem seu próprio efeito de vidro fosco.
        -->
        <div x-show="mobileMenuOpen" 
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0 -translate-y-4"
             x-transition:enter-end="opacity-100 translate-y-0"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100 translate-y-0"
             x-transition:leave-end="opacity-0 -translate-y-4"
             class="md:hidden fixed inset-x-0 top-16 z-40 bg-slate-50/95 dark:bg-slate-900/95 backdrop-blur-lg p-4 border-t border-slate-200 dark:border-slate-700" 
             style="display: none;">
            <div class="space-y-2">
                <a href="{% url 'home' %}" class="flex items-center px-4 py-3 text-base font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-lg"><i class="bi bi-chat-right-text-fill mr-3"></i> ChatBOT</a>
                <a href="{% url 'document_list' %}" class="flex items-center px-4 py-3 text-base font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-lg"><i class="bi bi-file-earmark-zip-fill mr-3"></i> Documentos</a>
                <a href="{% url 'dashboards' %}" class="flex items-center px-4 py-3 text-base font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-lg"><i class="bi bi-bar-chart-line-fill mr-3"></i> Dashboards</a>
            </div>
        </div>
    </header>
    {% endif %}

    <main>
        {% block content %}{% endblock %}
    </main>

    {% block extra_js %}{% endblock %}
</body>
</html>
